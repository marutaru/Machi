// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var init, lat, long, makerManager, map, myMarker, roomName, socket;
    lat = 41;
    long = 140;
    roomName = null;
    map = null;
    makerManager = [];
    myMarker = null;

    /*
    navigator.geolocation.getCurrentPosition (position) ->
      lat = position.coords.latitude
      long = position.coords.longitude
      $("#lat").val(lat)
      $("#long").val(long)
    ,(error) ->
      console.log error
     */
    $("#update").hide();
    socket = io.connect("http://localhost:3000");
    $("#join").click(function(event) {
      var info, latlng;
      lat = $("#lat").val();
      long = $("#long").val();
      info = {
        "name": $("#username").val(),
        "aikotoba": $("#aikotoba").val(),
        "lat": lat,
        "long": long
      };
      console.log("click" + info.name);
      init();
      latlng = new google.maps.LatLng(lat, long);
      myMarker = new google.maps.Marker({
        "position": latlng,
        "map": map
      });
      socket.emit("enter", info);
      $(this).hide();
      return $("#update").show();
    });
    init = function() {
      var myOptions;
      myOptions = {
        "center": new google.maps.LatLng(lat, long),
        "zoom": 12,
        "mapTypeId": google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map($("#map_canvas").get(0), myOptions);
      return console.log("maps init");
    };
    $("#update").click(function(event) {
      var info, latlng;
      console.log("update");
      lat = $("#lat").val();
      long = $("#long").val();
      info = {
        "name": $("#username").val(),
        "aikotoba": $("#aikotoba").val(),
        "lat": lat,
        "long": long
      };
      latlng = new google.maps.LatLng(lat, long);
      myMarker.position = latlng;
      myMarker.setMap(map);
      return socket.emit("update", info);
    });
    return socket.on("data", function(data) {
      roomName = data.aikotoba;
      $("#roomname").append("<div>" + data.aikotoba + "</div>");
      return $("#userinfo").append("<div>" + data.name + "</div>" + "<div>" + data.lat + "</div>" + "<div>" + data.long + "</div>");
    });
  });

}).call(this);
