// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var init, lat, long, map, roomname, socket;
    lat = 35;
    long = 140;
    roomname = null;
    map = null;
    navigator.geolocation.getCurrentPosition(function(position) {
      lat = position.coords.latitude;
      return long = position.coords.longitude;
    }, function(error) {
      return console.log(error);
    });
    socket = io.connect("http://localhost:3000");
    $("#join").click(function(event) {
      var info, latlng, marker;
      info = {
        "name": $("#username").val(),
        "aikotoba": $("#aikotoba").val(),
        "lat": lat,
        "long": long
      };
      console.log("click" + info.name);
      init();
      latlng = new google.maps.LatLng(lat, long);
      marker = new google.maps.Marker({
        "position": latlng,
        "map": map
      });
      return socket.emit("enter", info);
    });
    init = function() {
      var myOptions;
      myOptions = {
        "center": new google.maps.LatLng(lat, long),
        "zoom": 15,
        "mapTypeId": google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map($("#map_canvas").get(0), myOptions);
      return console.log("maps init");
    };
    $("#update").click(function(event) {
      var info;
      console.log("update");
      info = {
        "name": $("#username").val(),
        "aikotoba": $("#aikotoba").val(),
        "lat": lat,
        "long": long
      };
      return socket.emit("update", info);
    });
    return socket.on("data", function(data) {
      roomname = data.aikotoba;
      $("#roomname").append("<div>" + data.aikotoba + "</div>");
      return $("#userinfo").append("<div>" + data.name + "</div>" + "<div>" + data.lat + "</div>" + "<div>" + data.long + "</div>");
    });
  });

}).call(this);
