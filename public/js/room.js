// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    var lat, long, makerManager, map, mapInit, moveMarker, myMarker, newMarker, roomName, socket;
    lat = 41;
    long = 140;
    roomName = null;
    map = null;
    makerManager = [];
    myMarker = null;
    $("#update").hide();

    /*
    navigator.geolocation.getCurrentPosition (position) ->
      lat = position.coords.latitude
      long = position.coords.longitude
      $("#lat").val(lat)
      $("#long").val(long)
    ,(error) ->
      console.log error
     */
    socket = io.connect("http://localhost:3000");
    $("#join").click(function(event) {
      var latlng, my, name;
      lat = $("#lat").val();
      long = $("#long").val();
      name = $("#username").val();
      my = {
        "name": name,
        "aikotoba": $("#aikotoba").val(),
        "lat": lat,
        "long": long
      };
      console.log("click" + my.name);
      mapInit();
      latlng = new google.maps.LatLng(lat, long);
      myMarker = new google.maps.Marker({
        "position": latlng,
        "map": map,
        "title": name
      });
      socket.emit("enter", my);
      $(this).hide();
      return $("#update").show();
    });
    mapInit = function() {
      var option;
      option = {
        "center": new google.maps.LatLng(lat, long),
        "zoom": 10,
        "mapTypeId": google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map($("#map_canvas").get(0), option);
      return console.log("initilized maps");
    };
    $("#update").click(function(event) {
      var info;
      console.log("update");
      lat = $("#lat").val();
      long = $("#long").val();
      info = {
        "name": $("#username").val(),
        "aikotoba": $("#aikotoba").val(),
        "lat": lat,
        "long": long
      };
      moveMarker(info, myMarker);
      return socket.emit("update", info);
    });
    socket.on("data", function(data) {
      var latlng;
      roomName = data.aikotoba;
      latlng = new google.maps.LatLng(data.lat, data.long);
      return newMarker(data);
    });
    newMarker = function(data) {
      var latlng, marker;
      latlng = new google.maps.LatLng(data.lat, data.long);
      return marker = new google.maps.Marker({
        "position": latlng,
        "map": map,
        "title": data.name
      });
    };
    return moveMarker = function(data, marker) {
      var latlng;
      latlng = new google.maps.LatLng(data.lat, data.long);
      marker.position = latlng;
      return marker.setMap(map);
    };
  });

}).call(this);
